# Feature/Control Matrix

This matrix enumerates user-facing controls and their wiring based on code inspection. Each row is a distinct control/feature. References are to concrete functions/modules only (no guesses).

| ID | Area | Feature/Option Name | Purpose | Trigger | GUI Placement | Grouping/Section | Front-end Control | Front-end Handler | Back-end Call Path | Inputs/Parameters | Default Value(s) | Persistence | Memory Handling | Performance/Smoothness Impact | Failure Modes/Edge Cases | Notes/Proposed Changes |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| F-001 | CLI | `phage-annotator -i/--input` | Launch GUI with specified TIFF/OME-TIFF files. | CLI invocation | CLI | n/a | `click.option("-i/--input")` in `src/phage_annotator/cli.py` | `main()` in `src/phage_annotator/cli.py` | `main()` -> `gui_mpl.run_gui(paths)` in `src/phage_annotator/gui_mpl.py` | List[pathlib.Path] (TIFF/OME-TIFF); must exist | none (required when `--demo` is False) | none | No image I/O here; GUI loads later | Startup validation only | UsageError if no inputs; path must exist/readable | [VERIFIED] |
| F-002 | CLI | `phage-annotator --demo` | Generate a demo TIFF and open GUI. | CLI invocation | CLI | n/a | `click.option("--demo")` in `src/phage_annotator/cli.py` | `main()` in `src/phage_annotator/cli.py` | `main()` -> `demo.generate_dummy_image()` -> `gui_mpl.run_gui([path])` | None (flag) | False | none | Writes demo TIFF to CWD | Minor file I/O | Disk write failure | [VERIFIED] |
| F-003 | CLI | `phage-annotator --version` | Print version and exit. | CLI invocation | CLI | n/a | `click.version_option` in `src/phage_annotator/cli.py` | `main()` in `src/phage_annotator/cli.py` | Handled by Click (prints version then exits) | none | n/a | none | none | none | none | [VERIFIED] |
| F-004 | File | Open files… | Open one or more images. | Menu click | File > Open files… | File menu | QAction "Open files…" (created in `ui_actions.build_menus`) `triggered` | `_open_files()` in `src/phage_annotator/gui_actions.py` | `controller.open_files()` -> `_open_files_from_paths()` -> `gui_image_io.read_metadata()` -> `controller.add_images()` | TIFF/OME-TIFF paths | none | QSettings `recentImages` + session_state.last_folder | Metadata read; LazyImage added to session | I/O + metadata parse; scales with file count | Unreadable files; unsupported formats | [VERIFIED] |
| F-005 | File | Open folder… | Load all supported images in a folder. | Menu click | File > Open folder… | File menu | QAction "Open folder…" `triggered` (ui_actions) | `_open_folder()` in `src/phage_annotator/gui_actions.py` | `controller.open_folder()` -> `_open_files_from_paths()` -> `gui_image_io.read_metadata()`; builds annotation index | Folder path | none | QSettings `recentImages` + session_state.last_folder | Metadata read for each file; annotation index built | Folder scan + metadata I/O | Empty folder; unreadable files | [VERIFIED] |
| F-006 | File | Open Recent | Open a recent image path. | Menu click | File > Open Recent | File menu | `QMenu` actions added in `_populate_recent_menu()` | `_open_recent_image()` in `src/phage_annotator/gui_actions.py` | `_open_recent_image()` -> `_open_files_from_paths()` | Recent file path | List from QSettings | QSettings `recentImages` | No extra cache | Minor | Missing file path | [VERIFIED] |
| F-007 | File | Clear Recent | Clear recent image list. | Menu click | File > Open Recent > Clear Recent | File menu | QAction `recent_clear_act.triggered` | `_clear_recent_images()` in `src/phage_annotator/gui_actions.py` | `_save_recent_images([])` -> QSettings | none | none | QSettings `recentImages` | none | none | none | [VERIFIED] |
| F-008 | File | Load annotations for current image… | Import annotations for active image. | Menu click | File > Load annotations for current image… | File menu | QAction "Load annotations for current image…" `triggered` | `_load_annotations_current()` in `src/phage_annotator/gui_actions.py` | `controller.load_annotations()` (SessionAnnotationIOMixin) -> parse CSV/JSON -> merge | CSV/JSON paths | none | Project saves annotation imports in `.phageproj` | Annotation parsing only for selected files | Parsing cost scales with file size | Bad format; missing image mapping | [VERIFIED] |
| F-009 | File | Load annotations for multiple files… | Import annotations for multiple files. | Menu click | File > Load annotations for multiple files… | File menu | QAction "Load annotations for multiple files…" `triggered` | `_load_annotations_multi()` in `src/phage_annotator/gui_actions.py` | `controller.load_annotations()` (SessionAnnotationIOMixin) -> parse CSV/JSON -> merge | CSV/JSON paths | none | Project saves annotation imports in `.phageproj` | Parsing multiple files; merges by image | Potentially slow for large files | Format mismatch; missing image mapping | [VERIFIED] |
| F-010 | File | Load all annotations now | Bulk load indexed annotation files. | Menu click | File > Load all annotations now | File menu | QAction "Load all annotations now" `triggered` | `_load_annotations_all()` in `src/phage_annotator/gui_actions.py` | Job via `self.jobs.submit()` -> `_parse_annotations_from_paths()` -> merge | none | none | none | Reads all indexed annotation files | Background job; I/O bound | Large folders; cancel mid-run | [VERIFIED] |
| F-011 | File | Save annotations (CSV) | Save annotations for active image to CSV. | Menu click | File > Save annotations (CSV) | File menu | QAction "Save annotations (CSV)" `triggered` | `_save_csv()` in `src/phage_annotator/gui_export.py` | `SessionController.save_csv()` in `src/phage_annotator/session_controller_project.py` -> `annotations.save_keypoints_csv()` | Default CSV path (derived from image) | none | QSettings `encodeAnnotationMetaFilename` | Writes CSV to disk | Minor I/O | Write failure | [VERIFIED] |
| F-012 | File | Save annotations (JSON) | Save annotations for active image to JSON. | Menu click | File > Save annotations (JSON) | File menu | QAction "Save annotations (JSON)" `triggered` | `_save_json()` in `src/phage_annotator/gui_export.py` | `SessionController.save_json()` in `src/phage_annotator/session_controller_project.py` -> `annotations.save_keypoints_json()` | Default JSON path (derived from image) | none | QSettings `encodeAnnotationMetaFilename` | Writes JSON to disk | Minor I/O | Write failure | [VERIFIED] |
| F-013 | File | Export View… | Export current view with overlays. | Menu click | File > Export View… | File menu | QAction `export_view_act` `triggered` | `_export_view_dialog()` in `src/phage_annotator/gui_export.py` | `_export_view_dialog()` -> `_export_view_job()` -> `export_view.render_view_to_array()` (job) | Panel, scope, overlays | none | none | Uses render pipeline; no memmap load | Background job for export | Missing support frame/projection | [VERIFIED] |
| F-014 | File | Save project… | Save .phageproj and per-image data. | Menu click | File > Save project… | File menu | QAction `save_proj_act` `triggered` | `_save_project()` in `src/phage_annotator/gui_export.py` | `_save_project()` -> `SessionController.save_project()` -> `project_io.save_project()` | Path; settings dict | none | .phageproj | Writes project + annotation files | Disk I/O; scales with data | Write failure | [VERIFIED] |
| F-015 | File | Load project… | Load .phageproj and restore state. | Menu click | File > Load project… | File menu | QAction `load_proj_act` `triggered` | `_load_project()` in `src/phage_annotator/gui_export.py` | `_load_project()` -> `SessionController.load_project()` -> `project_io.load_project()` | Project path | none | .phageproj | Reads project JSON + annotation JSON | I/O; can be slow | Missing files; schema mismatch | [VERIFIED] |
| F-016 | File | Preferences… | Configure app defaults and policies. | Menu click | File > Preferences… | File menu | QAction `prefs_act` `triggered` | `_show_preferences_dialog()` in `src/phage_annotator/gui_controls_preferences.py` | `_show_preferences_dialog()` -> QSettings updates | Cache/recent/layout/LUT/FPS/autosave/pyramid/prefetch | Dialog defaults from QSettings | QSettings keys documented in dialog | None | None | Invalid values in settings | [VERIFIED] |
| F-017 | File | Exit | Quit app. | Menu click | File > Exit | File menu | QAction `exit_act` `triggered` | `close()` in `src/phage_annotator/gui_ui_setup.py` | Qt close event | none | none | none | none | unsaved changes | [VERIFIED] |
| F-018 | View | Toggle Overlay | Show/hide overlay text in image. | Menu toggle | View > Toggle Overlay | View menu | QAction `view_overlay_act` `triggered` | `_toggle_overlay()` in `src/phage_annotator/gui_rendering.py` | `_toggle_overlay()` -> `_refresh_image()` | bool | True | none | No extra allocations | Minor redraw | None | [VERIFIED] |
| F-019 | View | Show ROI Handles | Show ROI resize handles in canvas. | Menu toggle | View > Show ROI Handles | View menu | QAction `show_roi_handles_act` `toggled` | `_toggle_roi_handles()` in `src/phage_annotator/gui_roi_crop.py` | Updates renderer ROI handle visibility | bool | True | QSettings `showRoiHandles` (read in gui_mpl) | No extra | Minor redraw | None | [VERIFIED] |
| F-020 | View | Show Recorder | Show recorder dock. | Menu toggle | View > Show Recorder | View menu | QAction `show_recorder_act` `triggered` | `_toggle_recorder()` in `src/phage_annotator/gui_controls_recorder.py` | Sets recorder dock visibility | bool | False | Dock state stored in layout | None | None | None | [VERIFIED] |
| F-021 | View | Layout Preset: Annotate | Apply dock/panel layout preset. | Menu click | View > Layout Presets > Annotate | View menu | QAction `preset_annotate_act` `triggered` (created in `ui_actions.build_menus`) | `apply_preset("Annotate")` in `src/phage_annotator/gui_ui_extra.py` | `ui_docks.init_panels` connects action -> `apply_preset` | none | n/a | QSettings `customState/customGeometry` (preserved) | None | Layout rearrange only | None | [VERIFIED] |
| F-022 | View | Layout Preset: Analyze | Apply preset layout. | Menu click | View > Layout Presets > Analyze | View menu | QAction `preset_analyze_act` `triggered` (created in `ui_actions.build_menus`) | `apply_preset("Analyze")` in `src/phage_annotator/gui_ui_extra.py` | `ui_docks.init_panels` connects action -> `apply_preset` | none | n/a | QSettings `customState/customGeometry` (preserved) | None | Layout rearrange only | None | [VERIFIED] |
| F-023 | View | Layout Preset: Minimal | Apply preset layout. | Menu click | View > Layout Presets > Minimal | View menu | QAction `preset_minimal_act` `triggered` (created in `ui_actions.build_menus`) | `apply_preset("Minimal")` in `src/phage_annotator/gui_ui_extra.py` | `ui_docks.init_panels` connects action -> `apply_preset` | none | n/a | QSettings `customState/customGeometry` (preserved) | None | Layout rearrange only | None | [VERIFIED] |
| F-024 | View | Layout Preset: Default | Apply default layout. | Menu click | View > Layout Presets > Default | View menu | QAction `preset_default_act` `triggered` (created in `ui_actions.build_menus`) | `apply_preset("Default")` in `src/phage_annotator/gui_ui_extra.py` | `ui_docks.init_panels` connects action -> `apply_preset` | none | n/a | QSettings `customState/customGeometry` (preserved) | None | Layout rearrange only | None | [VERIFIED] |
| F-025 | View | Save Layout as Default | Save dock layout to QSettings. | Menu click | View > Save Layout as Default | View menu | QAction `save_layout_default_act` `triggered` | `_save_layout_default()` in `src/phage_annotator/gui_ui_extra.py` | `ui_docks.init_panels` connects action -> `_save_layout_default()` | none | n/a | QSettings `customState`, `customGeometry` | None | None | Save failure | [VERIFIED] |
| F-026 | View | Reset Layout | Restore default layout. | Menu click | View > Reset Layout | View menu | QAction `reset_layout_act` `triggered` | `_reset_layout()` in `src/phage_annotator/gui_ui_extra.py` | `ui_docks.init_panels` connects action -> `_reset_layout()` | none | n/a | QSettings (layout remains unless saved) | None | None | None | [VERIFIED] |
| F-027 | View | Link zoom | Sync zoom across panels. | Menu toggle | View > Link zoom | View menu | QAction `link_zoom_act` `triggered` | `_on_link_zoom_menu()` in `src/phage_annotator/gui_actions.py` | `_on_link_zoom_menu()` -> `_refresh_image()` | bool | True | none | None | May increase redraws | None | [VERIFIED] |
| F-028 | View | Image Panels: Show Frame | Toggle Frame panel visibility. | Menu toggle | View > Image Panels > Show Frame | View menu | QAction `panel_actions["frame"]` `toggled` (created in `ui_actions.build_menus`) | `_on_panel_toggle()` in `src/phage_annotator/gui_roi_crop.py` | `_on_panel_toggle()` -> `_rebuild_figure_layout()` -> `_refresh_image()` | bool | True | QSettings layout state (saveState/saveGeometry) | Axes rebuilt in renderer | Layout rebuild cost | Cannot hide last panel | [VERIFIED] |
| F-029 | View | Image Panels: Show Mean | Toggle Mean panel. | Menu toggle | View > Image Panels > Show Mean | View menu | QAction `panel_actions["mean"]` `toggled` (created in `ui_actions.build_menus`) | `_on_panel_toggle()` in `src/phage_annotator/gui_roi_crop.py` | `_on_panel_toggle()` -> `_rebuild_figure_layout()` -> `_refresh_image()` | bool | True | QSettings layout state (saveState/saveGeometry) | Axes rebuilt in renderer | Layout rebuild cost | Cannot hide last panel | [VERIFIED] |
| F-030 | View | Image Panels: Show Composite | Toggle Composite panel. | Menu toggle | View > Image Panels > Show Composite | View menu | QAction `panel_actions["composite"]` `toggled` (created in `ui_actions.build_menus`) | `_on_panel_toggle()` in `src/phage_annotator/gui_roi_crop.py` | `_on_panel_toggle()` -> `_rebuild_figure_layout()` -> `_refresh_image()` | bool | True | QSettings layout state (saveState/saveGeometry) | Axes rebuilt in renderer | Layout rebuild cost | Cannot hide last panel | [VERIFIED] |
| F-031 | View | Image Panels: Show Support | Toggle Support panel. | Menu toggle | View > Image Panels > Show Support | View menu | QAction `panel_actions["support"]` `toggled` (created in `ui_actions.build_menus`) | `_on_panel_toggle()` in `src/phage_annotator/gui_roi_crop.py` | `_on_panel_toggle()` -> `_rebuild_figure_layout()` -> `_refresh_image()` | bool | True | QSettings layout state (saveState/saveGeometry) | Axes rebuilt in renderer | Layout rebuild cost | Cannot hide last panel | [VERIFIED] |
| F-032 | View | Image Panels: Show STD | Toggle STD panel. | Menu toggle | View > Image Panels > Show STD | View menu | QAction `panel_actions["std"]` `toggled` (created in `ui_actions.build_menus`) | `_on_panel_toggle()` in `src/phage_annotator/gui_roi_crop.py` | `_on_panel_toggle()` -> `_rebuild_figure_layout()` -> `_refresh_image()` | bool | True | QSettings layout state (saveState/saveGeometry) | Axes rebuilt in renderer | Layout rebuild cost | Cannot hide last panel | [VERIFIED] |
| F-033 | View | SMLM Overlay: Localization Points | Toggle point overlay. | Menu toggle | View > SMLM Overlays > Localization Points | View menu | QAction `show_smlm_points_act` `triggered` | `_toggle_smlm_points()` in `src/phage_annotator/gui_controls_smlm.py` | `_toggle_smlm_points()` -> `_refresh_image()` | bool | True | none | None | Minor render cost | None | Add per-image default? [VERIFIED] |
| F-034 | View | SMLM Overlay: SR Image Overlay | Toggle SR image overlay. | Menu toggle | View > SMLM Overlays > SR Image Overlay | View menu | QAction `show_smlm_sr_act` `triggered` | `_toggle_smlm_sr()` in `src/phage_annotator/gui_controls_smlm.py` | `_toggle_smlm_sr()` -> `_refresh_image()` | bool | True | none | None | Minor render cost | None | Add per-image default? [VERIFIED] |
| F-035 | View | Dock Panels toggles | Show/hide each dock. | Menu toggle | View > Dock Panels > <dock> | View menu | QAction (created in `ui_docks.init_panels`) `toggled` | `wire_dock_action()` in `src/phage_annotator/ui_docks.py` | `wire_dock_action()` keeps dock visibility/menu toggle synced | bool | Per `PanelSpec.default_visible` | QSettings layout state (saveState/saveGeometry) | None | None | None | [VERIFIED] |
| F-036 | Edit | Undo | Undo last annotation change. | Menu / shortcut | Edit > Undo / Ctrl+Z | Edit menu | QAction `undo_act` `triggered` | `undo_last_action()` in `src/phage_annotator/gui_annotations.py` | `undo_last_action()` -> `SessionController.undo()` | none | disabled when no undo | none | Uses undo stack | Minor | Empty stack | [VERIFIED] |
| F-037 | Edit | Redo | Redo last undone change. | Menu / shortcut | Edit > Redo / Ctrl+Shift+Z | Edit menu | QAction `redo_act` `triggered` | `redo_last_action()` in `src/phage_annotator/gui_annotations.py` | `redo_last_action()` -> `SessionController.redo()` | none | disabled when no redo | none | Uses redo stack | Minor | Empty stack | [VERIFIED] |
| F-038 | Edit | Copy Display Settings… | Copy LUT/min/max/gamma between images. | Menu click | Edit > Copy Display Settings… | Edit menu | QAction `copy_display_act` `triggered` | `_copy_display_settings()` in `src/phage_annotator/gui_controls_display.py` | `_apply_display_to_image()` on target(s) -> `_refresh_image()` | Target: support/all | none | none | None | Minor | None | [VERIFIED] |
| F-039 | Edit | Measure (Results) | Measure ROI stats into Results table. | Menu / shortcut | Edit > Measure (Results) / Ctrl+M | Edit menu | QAction `measure_act` `triggered` | `_results_measure_current()` in `src/phage_annotator/gui_controls_results.py` | `roi_stats()` + `results_widget.add_row()` | Active ROI, current slice | none | none | Uses frame array | Fast for small frame | ROI not set | [VERIFIED] |
| F-040 | Tools | Clear ROI | Clear active ROI. | Menu click | Tools > Clear ROI | Tools menu | QAction `clear_roi_act` `triggered` | `_clear_roi()` in `src/phage_annotator/gui_roi_crop.py` | `_clear_roi()` -> `SessionController.clear_roi()` -> `_refresh_image()` | none | none | none | None | None | Add confirmation? [VERIFIED] |
| F-041 | Tools | Reload annotations for current image | Re-read annotation files. | Menu click | Tools > Reload annotations for current image | Tools menu | QAction `reload_ann_act` `triggered` | `_reload_annotations_current()` in `src/phage_annotator/gui_actions.py` | `_start_annotation_load_job()` -> `_parse_annotations_from_paths()` -> merge | none | none | none | Reads files again | Possibly slow | Missing annotation files | Add progress/cancel. [VERIFIED] |
| F-042 | Analyze | Line profiles (raw vs corrected) | Open line profile dialog. | Menu click | Analyze > Line profiles (raw vs corrected) | Analyze menu | QAction `show_profiles_act` `triggered` | `_show_profile_dialog()` in `src/phage_annotator/gui_actions.py` | Computes profiles from current frame, shows dialog | none | none | None | May be heavy on large images | No image loaded | [VERIFIED] |
| F-043 | Analyze | ROI mean + bleaching fit | Open bleaching fit dialog. | Menu click | Analyze > ROI mean + bleaching fit | Analyze menu | QAction `show_bleach_act` `triggered` | `_show_bleach_dialog()` in `src/phage_annotator/gui_actions.py` | Job computes ROI mean -> `fit_bleach_curve` | ROI; time series | none | none | Background job | ROI missing; cancel | [VERIFIED] |
| F-044 | Analyze | ROI mean table (per file) | Open ROI mean table dialog. | Menu click | Analyze > ROI mean table (per file) | Analyze menu | QAction `show_table_act` `triggered` | `_show_table_dialog()` in `src/phage_annotator/gui_actions.py` | Computes ROI means per file | ROI; per file | none | none | May be heavy | ROI missing | [VERIFIED] |
| F-045 | Analyze | Threshold… | Show Threshold dock. | Menu click | Analyze > Threshold… | Analyze menu | QAction `threshold_act` `triggered` | `_show_threshold_panel()` in `src/phage_annotator/gui_actions.py` | Dock visibility toggle | none | none | none | None | None | [VERIFIED] |
| F-046 | Analyze | Analyze Particles… | Show Analyze Particles dock. | Menu click | Analyze > Analyze Particles… | Analyze menu | QAction `analyze_particles_act` `triggered` | `_show_analyze_particles_panel()` in `src/phage_annotator/gui_actions.py` | Dock visibility toggle | none | none | none | None | None | [VERIFIED] |
| F-047 | Analyze | SMLM > ThunderSTORM (ROI) | Open SMLM dock (Thunder tab). | Menu click | Analyze > SMLM > ThunderSTORM (ROI) | Analyze menu | QAction `smlm_act` `triggered` | `_show_smlm_panel()` in `src/phage_annotator/gui_actions.py` | Dock visible; tab set to ThunderSTORM | none | none | none | None | None | [VERIFIED] |
| F-048 | Analyze | SMLM > Deep-STORM (ROI) | Open SMLM dock (Deep tab). | Menu click | Analyze > SMLM > Deep-STORM (ROI) | Analyze menu | QAction `deepstorm_act` `triggered` | `_show_deepstorm_panel()` in `src/phage_annotator/gui_actions.py` | Dock visible; tab set to Deep-STORM | none | none | none | None | None | [VERIFIED] |
| F-049 | Analyze | SMLM > Re-run Last SMLM on ROI | Repeat last run using saved params. | Menu click | Analyze > SMLM > Re-run Last SMLM on ROI | Analyze menu | QAction `rerun_smlm_act` `triggered` | `_rerun_last_smlm()` in `src/phage_annotator/gui_controls_smlm.py` | Applies params then runs job | last params | none | none | Jobs; background | Missing last run | [VERIFIED] |
| F-050 | Help | About | Show About dialog. | Menu click | Help > About | Help menu | QAction `about_act` `triggered` | `_show_about()` in `src/phage_annotator/gui_actions.py` | Qt dialog | none | none | none | None | None | Add version + build info. [VERIFIED] |
| F-051 | Other | Command Palette | Search and execute actions. | Shortcut / menu | Ctrl+Shift+P | Global action | QAction `command_palette_act` `triggered` | `_show_command_palette()` in `src/phage_annotator/gui_ui_extra.py` | Collects actions and triggers selected QAction | Filter text | none | none | Minimal | Disabled actions not runnable | [VERIFIED] |
| F-052 | Other | Reset View | Reset zoom/contrast. | Shortcut or action | QAction `reset_view_act` (no menu) | Global action | QAction `reset_view_act` `triggered` | `reset_all_view()` in `src/phage_annotator/gui_events.py` | `reset_contrast()` -> `reset_view()` -> `_refresh_image()` | none | none | none | Rebuilds view | Minor | None | Consider confirm if destructive applies. [VERIFIED] |
| F-053 | Debug | Dev: Demo Job | Runs demo background job. | Trigger action | Hidden action | Global action | QAction `_dev_demo_job_act` `triggered` | `_run_demo_job()` in `src/phage_annotator/gui_jobs.py` | `JobManager.submit()` demo job | n/a | none | none | Jobs thread | None | [VERIFIED] |
| F-054 | Navigation | FOV list | Select active image. | List selection | Sidebar > Explore panel | Sidebar/Explore | `QListWidget` `fov_list.currentRowChanged` | `_set_fov()` in `src/phage_annotator/gui_controls_display.py` | `_set_fov()` updates indices + refreshes view | index | 0 | none | Lazy load on demand | Some load delay | Index out of range | [VERIFIED] |
| F-055 | Navigation | Primary image combo | Change primary image. | Combo change | Sidebar > Explore | Explore panel | `QComboBox` `primary_combo.currentIndexChanged` | `_set_primary_combo()` in `src/phage_annotator/gui_controls_display.py` | `_set_primary_combo()` updates indices + refreshes view | index | 0 | none | Lazy load | Some load delay | Index invalid | [VERIFIED] |
| F-056 | Navigation | Support image combo | Change support image. | Combo change | Sidebar > Explore | Explore panel | `QComboBox` `support_combo.currentIndexChanged` | `_set_support_combo()` in `src/phage_annotator/gui_controls_display.py` | `_set_support_combo()` updates support + refreshes view | index | 1 | none | Lazy load | Some load delay | Index invalid | [VERIFIED] |
| F-057 | Navigation | Clear FOV list | Clear loaded list (keep current). | Button click | Sidebar > Explore | Explore panel | `QPushButton` `clear_fovs_btn.clicked` | `_clear_fov_list()` in `src/phage_annotator/gui_actions.py` | `retain_single_image()` -> repopulate UI | none | none | none | Clears caches for other images | Minor | No images | [VERIFIED] |
| F-058 | Navigation | Sidebar mode: Explore/Annotate/Analyze | Switch left sidebar page. | Activity bar click | Sidebar > Activity Bar | Sidebar | QAction in `_build_sidebar_stack` | `_set_sidebar_mode()` in `src/phage_annotator/gui_ui_extra.py` | `QStackedWidget.setCurrentIndex()` | 0-2 | 0 | QSettings `sidebarMode` | None | None | None | [VERIFIED] |
| F-059 | Playback | T slider | Change time index. | Slider drag | Settings pane | Primary controls | `QSlider` `t_slider.valueChanged` | `_on_play_tick()` in `src/phage_annotator/gui_controls_display.py` | `_on_play_tick()` -> `_refresh_image()` (when not playing) | int frames | 0 | none | May trigger load/projection | Frequent redraw | Large stacks | [VERIFIED] |
| F-060 | Playback | Z slider | Change Z index. | Slider drag | Settings pane | Primary controls | `QSlider` `z_slider.valueChanged` | `_on_play_tick()` in `src/phage_annotator/gui_controls_display.py` | `_on_play_tick()` -> `_refresh_image()` (when not playing) | int | 0 | none | May trigger load/projection | Frequent redraw | Large stacks | [VERIFIED] |
| F-061 | Playback | Play T | Start/stop T playback. | Button click | Settings pane | Primary controls | `QPushButton` `play_t_btn.clicked` | `_toggle_play("t")` in `src/phage_annotator/gui_controls_display.py` | `start_playback_t()` / `stop_playback_t()` | fps | n/a | QSettings `defaultFPS` | Ring buffer prefetch | Smoothness depends on prefetch | Buffer underrun | [VERIFIED] |
| F-062 | Playback | Play Z | Start/stop Z playback (uses T playback loop). | Button click | Settings pane | Primary controls | `QPushButton` `play_z_btn.clicked` | `_toggle_play("z")` in `src/phage_annotator/gui_controls_display.py` | `start_playback_t()` / `stop_playback_t()` | fps | n/a | QSettings `defaultFPS` | Ring buffer prefetch | Smoothness depends on prefetch | Buffer underrun | [VERIFIED] |
| F-063 | Playback | Speed slider | Adjust FPS (read by playback thread). | Slider drag | Settings pane | Primary controls | `QSlider` `speed_slider` (no direct signal handler) | None (value read in `gui_playback._playback_tick`) | Playback loop uses `speed_slider.value()` | 1..DEFAULT_PLAYBACK_FPS | DEFAULT_PLAYBACK_FPS | QSettings `defaultFPS` (set on startup) | None | Impacts playback rate | Too high for disk | [VERIFIED] |
| F-064 | Playback | Loop checkbox | Toggle loop. | Check | Settings pane | Primary controls | `QCheckBox` `loop_chk.stateChanged` | `_on_loop_change()` in `src/phage_annotator/gui_controls_display.py` | Sets `loop_playback` | bool | False | none | None | None | None | [VERIFIED] |
| F-065 | Display | Pixel size (um/px) | Set calibration for scale bar/area. | SpinBox | Settings pane | Primary controls | `QDoubleSpinBox` `pixel_size_spin.valueChanged` | `_on_pixel_size_change()` in `src/phage_annotator/gui_controls_preferences.py` | Updates calibration + refresh | float | defaultPixelSizeUmPerPx | QSettings `defaultPixelSizeUmPerPx` | None | Minor redraw | Invalid values | [VERIFIED] |
| F-066 | Display | Reset view | Reset zoom/contrast. | Button | Settings pane | Primary controls | `QPushButton` `reset_view_btn.clicked` | `reset_all_view()` in `src/phage_annotator/gui_events.py` | `reset_contrast()` + `reset_view()` | n/a | none | none | Resets view | Minor | None | [VERIFIED] |
| F-067 | Display | Vmin slider + +/- | Adjust lower display window. | Slider/Buttons | Settings pane > Display | Display group | `QSlider` `vmin_slider.valueChanged` + +/- buttons | `_on_vminmax_change()` in `src/phage_annotator/gui_controls_display.py` | Updates `DisplayMapping` and refresh | 0–100 percentile | 5% | none | No data modification | Frequent refresh | Huge stacks | [VERIFIED] |
| F-068 | Display | Vmax slider + +/- | Adjust upper display window. | Slider/Buttons | Settings pane > Display | Display group | `QSlider` `vmax_slider.valueChanged` + +/- buttons | `_on_vminmax_change()` in `src/phage_annotator/gui_controls_display.py` | Updates `DisplayMapping` and refresh | 0–100 percentile | 95% | none | No data modification | Frequent refresh | Huge stacks | [VERIFIED] |
| F-069 | Display | Auto contrast | Auto window via percentiles. | Button click | Settings pane > Display | Display group | `QPushButton` `auto_btn.clicked` | `_auto_contrast()` in `src/phage_annotator/gui_controls_display.py` | Quick preview + job `compute_auto_window` | low/high pct; scope; ROI | 0.35/99.65 | QSettings `autoLowPct`, `autoHighPct` | Sampling stack | Background job | Cancel/stale jobs | [VERIFIED] |
| F-070 | Display | Auto Set… | Set auto percentiles. | Button click | Settings pane > Display | Display group | `QPushButton` `auto_set_btn.clicked` | `_auto_set_dialog()` in `src/phage_annotator/gui_controls_display.py` | Updates QSettings | low/high 0–100 | 0.35/99.65 | QSettings `autoLowPct`, `autoHighPct` | none | none | invalid range | [VERIFIED] |
| F-071 | Display | Auto options: scope | Set auto contrast scope. | Combo change | Settings pane > Display | Display group | `QComboBox` `auto_scope_combo` | Read in `_auto_contrast()` | Scope selection | Current slice | none | Sampling stack | Job on full stack | Large stacks | [VERIFIED] |
| F-072 | Display | Auto options: target | Apply auto contrast to panel(s). | Combo change | Settings pane > Display | Display group | `QComboBox` `auto_target_combo` | Read in `_auto_contrast()` | Panel target | Current panel | none | none | none | None | [VERIFIED] |
| F-073 | Display | Auto options: Use ROI only | Restrict auto to ROI. | Check | Settings pane > Display | Display group | `QCheckBox` `auto_roi_chk` | Read in `_auto_contrast()` | bool | False | none | ROI mask applied | Minor | ROI empty | [VERIFIED] |
| F-074 | Display | LUT selector | Choose colormap. | Combo change | Settings pane > Display | Display group | `QComboBox` `lut_combo.currentIndexChanged` | `_on_lut_change()` in `src/phage_annotator/gui_controls_display.py` | Updates DisplayMapping + refresh | LUT name | defaultColormap | QSettings `defaultColormap` | none | Re-render | Invalid LUT | [VERIFIED] |
| F-075 | Display | Invert LUT | Toggle LUT inversion. | Check | Settings pane > Display | Display group | `QCheckBox` `lut_invert_chk.stateChanged` | `_on_lut_invert()` in `src/phage_annotator/gui_controls_display.py` | Updates mapping + refresh | bool | False | none | none | Minor | Unsupported LUT | [VERIFIED] |
| F-076 | Display | Gamma | Adjust gamma. | Slider | Settings pane > Display | Display group | `QSlider` `gamma_slider.valueChanged` | `_on_gamma_change()` in `src/phage_annotator/gui_controls_display.py` | Updates mapping + refresh | 0.2–5.0 | 1.0 | none | none | Frequent redraw | None | [VERIFIED] |
| F-077 | Display | Log display | Toggle log scale. | Check | Settings pane > Display | Display group | `QCheckBox` `log_chk.stateChanged` | `_on_log_toggle()` in `src/phage_annotator/gui_controls_display.py` | Updates mapping + refresh | linear/log | off | none | none | Minor | None | [VERIFIED] |
| F-078 | Display | Scale bar toggle | Enable scale bar overlay. | Check | Settings pane > Display | Display group | `QCheckBox` `scalebar_chk.toggled` | `_on_scalebar_change()` in `src/phage_annotator/gui_controls_preferences.py` | Updates ScaleBarSpec + refresh | bool | False | QSettings `scaleBarEnabled` | none | Minor draw | No calibration | [VERIFIED] |
| F-079 | Display | Scale bar length | Set bar length (um). | SpinBox | Settings pane > Display | Display group | `QDoubleSpinBox` `scalebar_length_spin.valueChanged` | `_on_scalebar_change()` in `src/phage_annotator/gui_controls_preferences.py` | Updates ScaleBarSpec + refresh | float | 5.0 | QSettings `scaleBarLengthUm` | none | None | No calibration | [VERIFIED] |
| F-080 | Display | Scale bar thickness | Set bar thickness (px). | SpinBox | Settings pane > Display | Display group | `QSpinBox` `scalebar_thickness_spin.valueChanged` | `_on_scalebar_change()` in `src/phage_annotator/gui_controls_preferences.py` | Updates ScaleBarSpec + refresh | 1–20 | 4 | QSettings `scaleBarThicknessPx` | none | None | None | [VERIFIED] |
| F-081 | Display | Scale bar location | Set bar position. | Combo | Settings pane > Display | Display group | `QComboBox` `scalebar_location_combo.currentTextChanged` | `_on_scalebar_change()` in `src/phage_annotator/gui_controls_preferences.py` | Updates ScaleBarSpec + refresh | position | bottom_right | QSettings `scaleBarLocation` | none | None | None | [VERIFIED] |
| F-082 | Display | Scale bar flags | Text/background/export options. | Checkboxes | Settings pane > Display | Display group | `QCheckBox` toggles | `_on_scalebar_change()` in `src/phage_annotator/gui_controls_preferences.py` | Updates ScaleBarSpec + refresh | bool | text on / bg on / export on | QSettings `scaleBarShowText`, `scaleBarBackgroundBox`, `scaleBarIncludeInExport` | none | None | None | [VERIFIED] |
| F-083 | Display | Apply display mapping to pixels… | Destructive rescale of pixel array. | Button | Settings pane > Advanced | Advanced group | `QPushButton` `apply_display_btn.clicked` | `_apply_display_mapping()` in `src/phage_annotator/gui_controls_display.py` | Modifies array in memory | none | none | none | Modifies array | Potential heavy | Irreversible | [VERIFIED] |
| F-084 | Display | Axis interpretation | Set 3D axis interpretation. | Combo | Settings pane > Advanced | Advanced group | `QComboBox` `axis_mode_combo.currentTextChanged` | `_on_axis_mode_change()` in `src/phage_annotator/gui_controls_display.py` | Evicts cache + refresh | auto/time/depth | auto | Project file | Invalidates cache | Can be slow | Missing metadata | [VERIFIED] |
| F-085 | Display | Projection cache budget | Set cache max MB. | SpinBox | Settings pane > Advanced | Advanced group | `QSpinBox` `cache_budget_spin.valueChanged` | `_on_cache_budget_change()` in `src/phage_annotator/gui_controls_preferences.py` | Sets ProjectionCache budget | 64–8192 MB | 1024 | QSettings `cacheMaxMB` | Eviction | None | Too low budget | [VERIFIED] |
| F-086 | Display | Downsample factor | Set interactive downsample factor. | SpinBox | Settings pane > Advanced | Advanced group | `QSpinBox` `downsample_factor_spin.valueChanged` | `_on_downsample_factor_change()` in `src/phage_annotator/gui_controls_preferences.py` | Updates downsample factor | 1–8 | from settings | QSettings `downsampleFactor` | none | Improves interaction | None | [VERIFIED] |
| F-087 | Display | Downsample toggles | Enable downsample for image/hist/profile. | Check | Settings pane > Advanced | Advanced group | `QCheckBox` toggles | `_on_downsample_toggle()` in `src/phage_annotator/gui_controls_preferences.py` | Updates downsample flags | bool | from settings | QSettings `downsampleImages`, `downsampleHist`, `downsampleProfile` | none | Improves responsiveness | None | [VERIFIED] |
| F-088 | Display | Pyramid enable | Enable multi-resolution pyramid. | Check | Settings pane > Advanced | Advanced group | `QCheckBox` `pyramid_chk.stateChanged` | `_on_pyramid_toggle()` in `src/phage_annotator/gui_controls_preferences.py` | Updates pyramid usage + refresh | bool | False | QSettings `pyramidEnabled` | Caches pyramid levels | Improves zoom/pan | Extra memory | [VERIFIED] |
| F-089 | Display | Pyramid levels | Set max pyramid levels. | SpinBox | Settings pane > Advanced | Advanced group | `QSpinBox` `pyramid_levels_spin.valueChanged` | `_on_pyramid_levels_change()` in `src/phage_annotator/gui_controls_preferences.py` | Updates max levels + refresh | 1–4 | 3 | QSettings `pyramidMaxLevels` | Controls cache size | Some re-render | None | [VERIFIED] |
| F-090 | Display | Overlay text | Show overlay with filename, T/Z, LUT, etc. | Menu toggle | View > Toggle Overlay | View menu | QAction `view_overlay_act` `triggered` | `_toggle_overlay()` in `src/phage_annotator/gui_rendering.py` | Overlay text toggle | bool | True | none | None | Minimal | None | [VERIFIED] |
| F-091 | Annotations | Annotation table | Edit/inspect annotations. | Table edit/select | Dock: Annotation Table | Dock panel | `annot_table.itemChanged/itemSelectionChanged` | `_on_table_item_changed()` / `_on_table_selection()` in `src/phage_annotator/gui_table_status.py` | `update_annotation()` / `_refresh_image()` | row values | none | `.phageproj` + JSON | In-memory list | Minimal | Invalid edits | [VERIFIED] |
| F-092 | Annotations | Show current slice only | Filter table rows. | Check | Annotation Table dock | Dock | `filter_current_chk.stateChanged` | `_refresh_table()` in `src/phage_annotator/gui_table_status.py` | Filters `_current_keypoints()` | bool | False | none | none | None | None | [VERIFIED] |
| F-093 | Annotations | Label selection | Choose annotation label. | Radio button | Sidebar > Annotate | Labels group | `QButtonGroup` `label_buttons.buttonClicked` | `_on_label_change()` in `src/phage_annotator/gui_controls_display.py` | Updates current label | label | first label | none | none | none | None | [VERIFIED] |
| F-094 | Annotations | Scope selection | Current slice vs all slices. | Radio button | Sidebar > Annotate | Annotation scope | `QButtonGroup` `scope_group.buttonClicked` | `_on_scope_change()` in `src/phage_annotator/gui_controls_display.py` | Updates annotation scope | current/all | All slices | none | none | none | None | [VERIFIED] |
| F-095 | Annotations | Target panel | Panel for annotation input. | Radio button | Sidebar > Annotate | Target panel | `QButtonGroup` `target_group.buttonClicked` | `_on_target_change()` in `src/phage_annotator/gui_controls_display.py` | Updates annotate target | Frame/Mean/Composite/Support | Mean | none | none | none | None | [VERIFIED] |
| F-096 | Annotations | Marker size | Set annotation marker size. | SpinBox | Settings pane | Display | `QSpinBox` `marker_size_spin.valueChanged` | `_on_marker_size_change()` in `src/phage_annotator/gui_controls_display.py` | Updates marker size + refresh | float | from settings | none | none | minor | none | [VERIFIED] |
| F-097 | Annotations | Click radius | Set eraser/selection radius (px). | SpinBox | Settings pane | Display | `QDoubleSpinBox` `click_radius_spin.valueChanged` | `_on_click_radius_change()` in `src/phage_annotator/gui_controls_display.py` | Updates click radius | float | from settings | none | none | none | none | [VERIFIED] |
| F-098 | Annotations | Mouse click add/remove | Add/remove annotations. | Mouse click | Canvas | Tool router | `mpl_connect("button_press_event")` -> `_on_click()` | `_on_click()` in `src/phage_annotator/gui_annotations.py` | `ToolRouter.on_click()` -> `SessionController.add_annotation/delete_annotations` | coords, t/z, label | n/a | `.phageproj` + JSON | No extra | Fast | Click outside ROI ignored | [VERIFIED] |
| F-099 | Annotations | Eraser tool | Remove nearest point. | Mouse click | Toolbar | Tool bar | QAction `Tool.ERASER` (toolbar) | `ToolRouter.on_click()` | `SessionController.delete_annotations()` | radius px | n/a | none | None | O(n) per click | Many annotations | [VERIFIED] |
| F-100 | ROI | ROI Controls dock | Set ROI/crop values and Auto-ROI. | Dock widgets | Dock: ROI Controls | ROI dock | SpinBoxes/Buttons (roi/crop/auto) | `_on_roi_change()`/`_on_crop_change()`/`_run_auto_roi()` in `gui_roi_crop.py` | Updates controller ROI/crop + refresh | X/Y/W/H | from state | QSettings `autoRoi*` | ROI stored in view_state | Affects analysis/hist | Out of bounds | [VERIFIED] |
| F-101 | ROI | ROI shape | Set box or circle. | Radio buttons | ROI Controls dock | ROI dock | `roi_shape_group.buttonClicked` | `_on_roi_shape_change()` in `src/phage_annotator/gui_roi_crop.py` | Updates ROI shape | box/circle | circle | none | none | none | None | [VERIFIED] |
| F-102 | ROI | ROI X/Y/W/H | Direct ROI rectangle values. | SpinBoxes | ROI Controls dock | ROI dock | `roi_x_spin/roi_y_spin/roi_w_spin/roi_h_spin.valueChanged` | `_on_roi_change()` in `src/phage_annotator/gui_roi_crop.py` | Updates controller ROI + refresh | float px | from state | none | none | none | ROI outside bounds | [VERIFIED] |
| F-103 | ROI | Crop X/Y/W/H | Crop rectangle. | SpinBoxes | ROI Controls dock | ROI dock | `crop_x_spin/crop_y_spin/crop_w_spin/crop_h_spin.valueChanged` | `_on_crop_change()` in `src/phage_annotator/gui_roi_crop.py` | Updates crop rect + refresh | float px | none | none | none | none | Crop out of bounds | [VERIFIED] |
| F-104 | ROI | Auto ROI | Propose ROI based on uniformity. | Button | ROI Controls dock | Auto ROI group | `auto_roi_btn.clicked` | `_run_auto_roi()` in `src/phage_annotator/gui_roi_crop.py` | `auto_roi.propose_roi()` via jobs | shape/mode/size | 100x100 | QSettings `autoRoi*` + `.phageproj` | Uses background job | Job thread | Cancel/stale | [VERIFIED] |
| F-105 | ROI | Auto ROI shape | Choose box/circle/auto. | Combo | ROI Controls dock | Auto ROI group | `auto_roi_shape_combo.currentTextChanged` | `_persist_auto_roi_settings()` in `src/phage_annotator/gui_roi_crop.py` | Saved in QSettings | box/circle/auto | box | QSettings + project | none | none | none | [VERIFIED] |
| F-106 | ROI | Auto ROI size mode | Choose W/H vs Area. | Combo | ROI Controls dock | Auto ROI group | `auto_roi_mode_combo.currentTextChanged` | `_auto_roi_mode_changed()` in `src/phage_annotator/gui_roi_crop.py` | Updates size mode | W/H or Area | W/H | QSettings + project | none | none | none | [VERIFIED] |
| F-107 | ROI | Auto ROI W/H/Area | Size parameters. | SpinBox | ROI Controls dock | Auto ROI group | `auto_roi_w_spin/auto_roi_h_spin/auto_roi_area_spin.valueChanged` | `_persist_auto_roi_settings()` in `src/phage_annotator/gui_roi_crop.py` | Saved in QSettings | px | 100/100/10000 | QSettings + project | none | none | none | [VERIFIED] |
| F-108 | ROI | Reset ROI | Reset to full bounds. | Button | Sidebar > Analyze | ROI group | `roi_reset.clicked` | `_reset_roi()` in `src/phage_annotator/gui_roi_crop.py` | Sets ROI to full image | image dims | full size | none | none | none | missing image shape | [VERIFIED] |
| F-109 | ROI | Show ROI Controls | Show ROI dock. | Button | Sidebar > Analyze | ROI group | `roi_show.clicked` | lambda in `src/phage_annotator/gui_ui_extra.py` | Dock visibility | none | n/a | none | none | none | None | [VERIFIED] |
| F-110 | ROI | ROI Manager dock | Manage multiple ROIs list. | Dock controls | Dock: ROI Manager | ROI Manager panel | `RoiManagerWidget` buttons/table | Handlers in `src/phage_annotator/gui_controls_roi.py` | `roi_manager` store + refresh view | ROI types | none | `.phageproj` (rois_by_image) | Stores ROI definitions | Minimal | No ROI selected | [VERIFIED] |
| F-111 | ROI | ROI Manager Add | Add ROI from current ROI. | Button | ROI Manager dock | ROI Manager | `add_btn.clicked` | `_roi_mgr_add()` in `src/phage_annotator/gui_controls_roi.py` | `roi_manager.add_roi()` | ROI type | none | none | none | None | ROI missing | [VERIFIED] |
| F-112 | ROI | ROI Manager Delete | Delete selected ROI. | Button | ROI Manager dock | ROI Manager | `del_btn.clicked` | `_roi_mgr_delete()` in `src/phage_annotator/gui_controls_roi.py` | `roi_manager.delete_roi()` | ROI id | none | none | none | None | No selection | [VERIFIED] |
| F-113 | ROI | ROI Manager Rename | Rename selected ROI. | Button | ROI Manager dock | ROI Manager | `rename_btn.clicked` | `_roi_mgr_rename()` in `src/phage_annotator/gui_controls_roi.py` | Updates ROI name | name | none | none | none | None | Cancel dialog | [VERIFIED] |
| F-114 | ROI | ROI Manager Duplicate | Duplicate selected ROI. | Button | ROI Manager dock | ROI Manager | `dup_btn.clicked` | `_roi_mgr_duplicate()` in `src/phage_annotator/gui_controls_roi.py` | `roi_manager.add_roi()` | ROI id | none | none | none | None | No selection | [VERIFIED] |
| F-115 | ROI | ROI Manager Save | Save ROIs JSON. | Button | ROI Manager dock | ROI Manager | `save_btn.clicked` | `_roi_mgr_save()` in `src/phage_annotator/gui_controls_roi.py` | `save_rois_json()` | path | none | file | disk write | minor | write failure | [VERIFIED] |
| F-116 | ROI | ROI Manager Load | Load ROIs JSON. | Button | ROI Manager dock | ROI Manager | `load_btn.clicked` | `_roi_mgr_load()` in `src/phage_annotator/gui_controls_roi.py` | `load_rois_json()` | path | none | file | disk read | minor | invalid JSON | [VERIFIED] |
| F-117 | ROI | ROI Manager Measure | Compute ROI mean over time. | Button | ROI Manager dock | ROI Manager | `measure_btn.clicked` | `_roi_mgr_measure()` in `src/phage_annotator/gui_controls_roi.py` | `roi_mean_timeseries()` | ROI list | none | none | Uses full array | heavy | large stacks | [VERIFIED] |
| F-118 | Playback | Histogram panel toggle | Show/hide histogram rendering. | Checkbox toggle | Histogram dock | Histogram panel | `QCheckBox` `hist_chk.stateChanged` | `_on_hist_chk_changed()` in `src/phage_annotator/gui_controls_display.py` | `_on_hist_chk_changed()` -> `_refresh_image()` -> `gui_rendering._draw_diagnostics()` | bool | True | none | None | Redraw histogram | None | [VERIFIED] |
| F-119 | Playback | Histogram region | Full/ROI/Crop histogram source. | Combo change | Histogram dock | Histogram panel | `QComboBox` `hist_region_combo.currentIndexChanged` | `_on_hist_region()` in `src/phage_annotator/gui_controls_display.py` | `_on_hist_region()` -> `_refresh_image()` -> `gui_rendering._hist_values()` | Full image / ROI / Crop area | Full image | none | ROI/crop masks applied | May increase compute | ROI missing | [VERIFIED] |
| F-120 | Playback | Histogram scope | Current slice vs sampled stack. | Combo change | Histogram dock | Histogram panel | `QComboBox` `hist_scope_combo.currentIndexChanged` | `_on_hist_scope_change()` in `src/phage_annotator/gui_controls_display.py` | `_on_hist_scope_change()` -> clears cache -> `_refresh_image()` | Current slice / Sampled stack | Current slice | none | Sampled stack uses background job | May be heavy on large stacks | Job cancel on scope change | [VERIFIED] |
| F-121 | Playback | Line Profile panel toggle | Show/hide profile rendering. | Checkbox toggle | Line Profile dock | Profile panel | `show_profile_chk` (QCheckBox, `stateChanged`) expected by `gui_events._bind_events` but widget creation not found | `_on_profile_chk_changed()` in `src/phage_annotator/gui_controls_display.py` | `self.profile_enabled = self.profile_chk.isChecked()` -> `SessionController.set_profile_enabled()` in `src/phage_annotator/session_controller_view.py` | bool | UNKNOWN (control not found) | UNKNOWN (control not found) | none | If wired, toggles profile redraw in `gui_rendering._refresh_diagnostics` | Missing widget; cannot toggle from UI | Missing control creation for `show_profile_chk` (see `gui_events.py`). [MISSING] |
| F-122 | Playback | Clear Profile | Clear active line profile. | Button click | Line Profile dock | Profile panel | `profile_clear_btn` (QPushButton, `clicked`) expected by `gui_events._bind_events` but widget creation not found | `_clear_profile()` in `src/phage_annotator/gui_controls_display.py` | `self.profile_line = None` -> `SessionController.set_profile_line()` in `src/phage_annotator/session_controller_view.py` | none | UNKNOWN (control not found) | UNKNOWN (control not found) | none | Clears profile line; reduces redraw load | Missing widget; cannot clear from UI | Missing control creation for `profile_clear_btn` (see `gui_events.py`). [MISSING] |
| F-123 | Navigation | Tool: Pan/Zoom | Activate Matplotlib nav mode. | Toolbar action / shortcut 1 | Top toolbar | Tools | QAction `Tool.PAN_ZOOM` | `_set_tool()` in `src/phage_annotator/gui_ui_extra.py` | `ToolRouter.set_tool()` + toolbar.pan() | n/a | n/a | none | none | none | None | [VERIFIED] |
| F-124 | Navigation | Tool: Annotate | Add/remove points. | Toolbar action / shortcut 2 | Top toolbar | Tools | QAction `Tool.ANNOTATE_POINT` | `_set_tool()` in `src/phage_annotator/gui_ui_extra.py` | `ToolRouter.set_tool()` | n/a | n/a | none | none | none | None | [VERIFIED] |
| F-125 | Navigation | Tool: ROI Box | Draw ROI box. | Toolbar action / shortcut 3/R | Top toolbar | Tools | QAction `Tool.ROI_BOX` | `_set_tool()` in `src/phage_annotator/gui_ui_extra.py` | `RoiInteractor.set_tool("draw_rect")` | drag box | n/a | none | none | interactive | ROI missing | [VERIFIED] |
| F-126 | Navigation | Tool: ROI Circle | Draw ROI circle. | Toolbar action / shortcut 4/O | Top toolbar | Tools | QAction `Tool.ROI_CIRCLE` | `_set_tool()` in `src/phage_annotator/gui_ui_extra.py` | `RoiInteractor.set_tool("draw_circle")` | drag circle | n/a | none | none | interactive | ROI missing | [VERIFIED] |
| F-127 | Navigation | Tool: ROI Edit | Edit ROI handles. | Toolbar action / shortcut E | Top toolbar | Tools | QAction `Tool.ROI_EDIT` | `_set_tool()` in `src/phage_annotator/gui_ui_extra.py` | `RoiInteractor.set_tool("edit")` | drag handles | n/a | none | none | interactive | ROI missing | [VERIFIED] |
| F-128 | Navigation | Tool: Profile Line | Draw line for profile. | Toolbar action / shortcut 5 | Top toolbar | Tools | QAction `Tool.PROFILE_LINE` | `_set_tool()` in `src/phage_annotator/gui_ui_extra.py` | `ToolRouter.set_tool()` | line endpoints | n/a | none | none | interactive | None | [VERIFIED] |
| F-129 | Navigation | Tool: Eraser | Remove nearest annotation. | Toolbar action / shortcut 6 | Top toolbar | Tools | QAction `Tool.ERASER` | `_set_tool()` in `src/phage_annotator/gui_ui_extra.py` | `ToolRouter.set_tool()` | click radius | n/a | none | none | none | None | [VERIFIED] |
| F-130 | Playback | Mouse wheel/zoom/pan | Navigate view. | Mouse interactions | Canvas | Matplotlib toolbar | `ax.callbacks.connect("xlim_changed/ylim_changed")` | `_on_limits_changed()` in `src/phage_annotator/gui_controls_display.py` | Updates linked zoom state | n/a | n/a | none | none | Frequent redraw | Linked zoom | [VERIFIED] |
| F-131 | Analysis | Results dock: Measure current | Measure active ROI stats. | Button | Results dock | Results panel | `measure_btn.clicked` | `_results_measure_current()` in `src/phage_annotator/gui_controls_results.py` | `roi_stats()` -> `results_widget.add_row()` | ROI; current slice | none | none | direct array access | minor | ROI missing | [VERIFIED] |
| F-132 | Analysis | Results dock: Measure over time | ROI stats over time. | Button | Results dock | Results panel | `measure_t_btn.clicked` | `_results_measure_over_time()` in `src/phage_annotator/gui_controls_results.py` | Job over T -> `results_widget.add_row()` | ROI; frames | none | none | uses jobs; arrays | heavy | large stacks | [VERIFIED] |
| F-133 | Analysis | Results dock: Clear | Clear results table. | Button | Results dock | Results panel | `clear_btn.clicked` | `_results_clear()` in `src/phage_annotator/gui_controls_results.py` | `results_widget.clear()` | none | none | none | none | none | none | [VERIFIED] |
| F-134 | Analysis | Results dock: Copy | Copy results to clipboard. | Button | Results dock | Results panel | `copy_btn.clicked` | `_results_copy()` in `src/phage_annotator/gui_controls_results.py` | `results_widget.copy_to_clipboard()` | none | none | none | none | none | none | [VERIFIED] |
| F-135 | Analysis | Results dock: Export | Export results CSV. | Button | Results dock | Results panel | `export_btn.clicked` | `_results_export()` in `src/phage_annotator/gui_controls_results.py` | `results_widget.export_csv()` | path | none | file | disk I/O | minor | write failure | [VERIFIED] |
| F-136 | SMLM | SMLM preset | Apply preset to SMLM params. | Combo change | SMLM dock | Preset row | `preset_combo.currentTextChanged` | `_apply_smlm_preset()` in `src/phage_annotator/gui_controls_smlm.py` | `SmlmPanel.apply_preset()` | Balanced/Conservative/Sensitive | Balanced | none | none | none | None | [VERIFIED] |
| F-137 | SMLM | ThunderSTORM params | Configure filter, thresholds, etc. | Input changes | SMLM dock (Thunder tab) | Form fields | Widgets in `smlm_widget.py` | Read by `_smlm_params_from_ui()` in `gui_controls_smlm.py` | `SmlmParams` in `smlm_thunderstorm.py` | See form ranges | defaults in widget | `.phageproj` via `smlm_runs` | none | none | invalid ranges | [VERIFIED] |
| F-138 | SMLM | Run ThunderSTORM | Run SMLM on ROI. | Button | SMLM dock | Thunder tab | `run_btn.clicked` | `_run_smlm()` in `src/phage_annotator/gui_controls_smlm.py` | `run_smlm_stream()` via `jobs.submit()` | ROI + params | none | `.phageproj` run history | Jobs; streams frames | heavy; background job | ROI missing; cancel | [VERIFIED] |
| F-139 | SMLM | Cancel ThunderSTORM | Cancel job. | Button | SMLM dock | Thunder tab | `cancel_btn.clicked` | `_cancel_smlm()` in `src/phage_annotator/gui_controls_smlm.py` | `JobManager.cancel()` | job id | disabled by default | none | cancels job | improves responsiveness | cancel may lag | [VERIFIED] |
| F-140 | SMLM | Export ThunderSTORM CSV | Export localizations. | Button | SMLM dock | Thunder tab | `export_csv_btn.clicked` | `_export_smlm_csv()` in `src/phage_annotator/gui_controls_smlm.py` | CSV write | path | none | file | I/O | minor | no results | [VERIFIED] |
| F-141 | SMLM | Export ThunderSTORM HDF5 | Export localizations HDF5. | Button | SMLM dock | Thunder tab | `export_h5_btn.clicked` | `_export_smlm_hdf5()` in `src/phage_annotator/gui_controls_smlm.py` | h5py write | path | none | file | I/O | minor | h5py missing | [VERIFIED] |
| F-142 | SMLM | Add to Annotations (Thunder) | Add SMLM points to annotation table. | Button | SMLM dock | Thunder tab | `add_ann_btn.clicked` | `_smlm_to_annotations()` in `src/phage_annotator/gui_controls_smlm.py` | `SessionController.add_annotation()` | points list | none | `.phageproj` | none | may be slow | large list | [VERIFIED] |
| F-143 | SMLM | Deep-STORM params | Configure model inference. | Input | SMLM dock (Deep tab) | Form fields | Widgets in `deepstorm_widget.py` | Read by `_deepstorm_params_from_ui()` in `gui_controls_smlm.py` | `DeepStormParams` in `deepstorm_infer.py` | See form ranges | defaults in widget | `.phageproj` run history | none | none | invalid model path | [VERIFIED] |
| F-144 | SMLM | Browse model | Select .pt model. | Tool button | SMLM dock | Deep tab | `browse_btn.clicked` | `_browse_deepstorm_model()` in `src/phage_annotator/gui_controls_smlm.py` | Sets model path text | path | none | none | none | none | missing file | [VERIFIED] |
| F-145 | SMLM | Run Deep-STORM | Run Deep inference on ROI. | Button | SMLM dock | Deep tab | `run_btn.clicked` | `_run_deepstorm()` in `src/phage_annotator/gui_controls_smlm.py` | `run_deepstorm_stream()` via `jobs.submit()` | ROI, params, device | none | `.phageproj` run history | jobs; GPU/CPU | heavy; background | ROI missing; CUDA missing | [VERIFIED] |
| F-146 | SMLM | Cancel Deep-STORM | Cancel job. | Button | SMLM dock | Deep tab | `cancel_btn.clicked` | `_cancel_deepstorm()` in `src/phage_annotator/gui_controls_smlm.py` | `JobManager.cancel()` | job id | disabled | none | cancels job | improves responsiveness | cancel may lag | [VERIFIED] |
| F-147 | SMLM | Export Deep-STORM CSV | Export localizations. | Button | SMLM dock | Deep tab | `export_csv_btn.clicked` | `_export_deepstorm_csv()` in `src/phage_annotator/gui_controls_smlm.py` | CSV write | path | none | file | I/O | minor | no results | [VERIFIED] |
| F-148 | SMLM | Export SR Image | Export SR overlay. | Button | SMLM dock | Deep tab | `export_sr_btn.clicked` | `_export_deepstorm_sr()` in `src/phage_annotator/gui_controls_smlm.py` | tif/png write | path | none | file | I/O | minor | no SR image | [VERIFIED] |
| F-149 | SMLM | Add to Annotations (Deep) | Add Deep-STORM points to annotations. | Button | SMLM dock | Deep tab | `add_ann_btn.clicked` | `_deepstorm_to_annotations()` in `src/phage_annotator/gui_controls_smlm.py` | `SessionController.add_annotation()` | points list | none | `.phageproj` | none | may be slow | large list | [VERIFIED] |
| F-150 | Threshold | Target selection | Choose source panel for thresholding. | Combo change | Threshold dock | Threshold panel | `target_combo.currentTextChanged` | `_threshold_refresh_preview()` in `src/phage_annotator/gui_controls_threshold.py` | `_threshold_source_image()` -> preview | Frame/Mean/Composite/Support | Frame | none | uses projections if needed | may trigger projection job | projection missing | [VERIFIED] |
| F-151 | Threshold | ROI only | Restrict threshold to ROI. | Check | Threshold dock | Threshold panel | `region_chk.stateChanged` | `_threshold_refresh_preview()` in `src/phage_annotator/gui_controls_threshold.py` | Applies ROI mask | bool | True | none | uses ROI mask | minor | ROI empty | [VERIFIED] |
| F-152 | Threshold | Scope | Current slice vs sampled stack. | Combo | Threshold dock | Threshold panel | `scope_combo.currentTextChanged` | `_threshold_refresh_preview()` in `src/phage_annotator/gui_controls_threshold.py` | Sampling selection | Current slice | none | may sample stack | job if auto | large stacks | [VERIFIED] |
| F-153 | Threshold | Sample frames | Number of frames sampled. | SpinBox | Threshold dock | Threshold panel | `sample_spin.valueChanged` | `_threshold_refresh_preview()` in `src/phage_annotator/gui_controls_threshold.py` | Sampling size | 2–200 | 20 | none | sampling frames | heavy if large | None | [VERIFIED] |
| F-154 | Threshold | Method | Manual vs auto methods. | Combo | Threshold dock | Threshold panel | `method_combo.currentTextChanged` | `_threshold_method_changed()` in `src/phage_annotator/gui_controls_threshold.py` | Sets method | Manual + AUTO_METHODS | Manual | none | none | may use job | auto methods unavailable | [VERIFIED] |
| F-155 | Threshold | Manual low/high | Manual threshold percentiles. | Sliders | Threshold dock | Manual group | `low_slider/high_slider.valueChanged` | `_threshold_manual_changed()` in `src/phage_annotator/gui_controls_threshold.py` | Updates preview | 0–100% | 20/99 | none | none | interactive | None | [VERIFIED] |
| F-156 | Threshold | Auto | Compute auto threshold. | Button | Threshold dock | Auto row | `auto_btn.clicked` | `_threshold_auto()` in `src/phage_annotator/gui_controls_threshold.py` | `compute_threshold()` via job | method; background | n/a | none | job thread | heavy on big stacks | cancel/stale | [VERIFIED] |
| F-157 | Threshold | Invert mask | Invert threshold. | Check | Threshold dock | Options | `invert_chk.stateChanged` | `_threshold_refresh_preview()` in `src/phage_annotator/gui_controls_threshold.py` | `make_mask()` invert | bool | False | none | none | minor | None | [VERIFIED] |
| F-158 | Threshold | Background | Set background mode. | Combo | Threshold dock | Options | `background_combo.currentTextChanged` | `_threshold_refresh_preview()` in `src/phage_annotator/gui_controls_threshold.py` | `compute_threshold()` | dark/bright | dark | none | none | none | None | [VERIFIED] |
| F-159 | Threshold | Smooth sigma | Gaussian smooth before threshold. | SpinBox | Threshold dock | Options | `smooth_spin.valueChanged` | `_threshold_refresh_preview()` in `src/phage_annotator/gui_controls_threshold.py` | `smooth_image()` | 0–2 px | 0.0 | none | extra compute | some cost | large images | [VERIFIED] |
| F-160 | Threshold | Preview overlay | Toggle live preview. | Check | Threshold dock | Options | `preview_chk.stateChanged` | `_threshold_refresh_preview()` in `src/phage_annotator/gui_controls_threshold.py` | Overlay mask toggle | bool | True | none | none | redraw | None | [VERIFIED] |
| F-161 | Threshold | Postprocess: min area | Remove small objects. | SpinBox | Threshold dock | Postprocess | `min_area_spin.valueChanged` | `_threshold_refresh_preview()` in `src/phage_annotator/gui_controls_threshold.py` | `postprocess_mask()` | 0–10000 | 5 | none | extra compute | cost | large masks | [VERIFIED] |
| F-162 | Threshold | Postprocess: fill holes | Fill holes. | Check | Threshold dock | Postprocess | `fill_holes_chk.stateChanged` | `_threshold_refresh_preview()` in `src/phage_annotator/gui_controls_threshold.py` | `postprocess_mask()` | bool | False | none | extra compute | cost | none | [VERIFIED] |
| F-163 | Threshold | Postprocess: open/close | Morphological open/close. | SpinBox | Threshold dock | Postprocess | `open_spin/close_spin.valueChanged` | `_threshold_refresh_preview()` in `src/phage_annotator/gui_controls_threshold.py` | `postprocess_mask()` | 0–5 px | 1 | none | extra compute | cost | none | [VERIFIED] |
| F-164 | Threshold | Postprocess: despeckle | Despeckle mask. | Check | Threshold dock | Postprocess | `despeckle_chk.stateChanged` | `_threshold_refresh_preview()` in `src/phage_annotator/gui_controls_threshold.py` | `postprocess_mask()` | bool | False | none | extra compute | cost | none | [VERIFIED] |
| F-165 | Threshold | Postprocess: watershed split | Split touching objects. | Check | Threshold dock | Postprocess | `watershed_chk.stateChanged` | `_threshold_refresh_preview()` in `src/phage_annotator/gui_controls_threshold.py` | `postprocess_mask()` | bool | False | none | extra compute | cost | none | [VERIFIED] |
| F-166 | Threshold | Create mask layer | Store current mask. | Button | Threshold dock | Buttons row | `create_mask_btn.clicked` | `_threshold_create_mask()` in `src/phage_annotator/gui_controls_threshold.py` | Stores mask in session | mask | n/a | `.phageproj` configs | mask stored | small | none | [VERIFIED] |
| F-167 | Threshold | Create ROI from mask | Generate ROI from mask bounds. | Button | Threshold dock | Buttons row | `create_roi_btn.clicked` | `_threshold_create_roi()` in `src/phage_annotator/gui_controls_threshold.py` | `SessionController.set_roi()` | bounding box | n/a | none | uses mask | minor | mask empty | [VERIFIED] |
| F-168 | Threshold | Analyze Particles… | Switch to Analyze Particles. | Button | Threshold dock | Buttons row | `analyze_btn.clicked` | `_threshold_analyze_particles()` in `src/phage_annotator/gui_controls_threshold.py` | Shows particles panel | n/a | n/a | none | none | none | none | [VERIFIED] |
| F-169 | Threshold | Apply (Destructive) | Convert view to binary mask. | Button | Threshold dock | Buttons row | `apply_btn.clicked` | `_threshold_apply_destructive()` in `src/phage_annotator/gui_controls_threshold.py` | Sets binary view mask | confirmation | n/a | none | stores mask | view changes | irreversible | [VERIFIED] |
| F-170 | Particles | Measure | Run Analyze Particles. | Button | Analyze Particles dock | Buttons row | `measure_btn.clicked` | `_run_analyze_particles()` in `src/phage_annotator/gui_controls_threshold.py` | `particles.analyze_particles()` | ROI/filters | none | `.phageproj` configs | may use jobs | heavy | no mask | [VERIFIED] |
| F-171 | Particles | Export CSV | Export particles table. | Button | Analyze Particles dock | Buttons row | `export_btn.clicked` | `_export_particles_csv()` in `src/phage_annotator/gui_controls_threshold.py` | CSV write | path | none | file | I/O | minor | no results | [VERIFIED] |
| F-172 | Particles | Create selection | Convert particles to ROI selection. | Button | Analyze Particles dock | Buttons row | `selection_btn.clicked` | `_particles_create_selection()` in `src/phage_annotator/gui_controls_threshold.py` | `SessionController.set_roi()` | bounding box | none | none | none | minor | no particles | [VERIFIED] |
| F-173 | Particles | Filters/Options | Region, scope, size, circularity, edges, holes, clear. | Input changes | Analyze Particles dock | Form controls | Widgets in `AnalyzeParticlesPanel` | Read in `_run_analyze_particles()` | `ParticleOptions` | see panel | defaults in panel | none | affects compute | potential heavy | invalid ranges | [VERIFIED] |
| F-174 | Particles | Overlay toggles | Outline/box/ellipse/labels. | Check | Analyze Particles dock | Show overlays | `show_outlines_chk` etc. | `_particles_refresh_overlay()` in `src/phage_annotator/gui_controls_threshold.py` | Overlay drawing | bool | outlines on | none | no extra | some draw cost | None | [VERIFIED] |
| F-175 | Density | Model file | Choose model .pt. | Button/Line edit | Density dock | Model group | `model_browse_btn.clicked` | `_density_pick_model()` in `src/phage_annotator/gui_controls_density.py` | Sets model path | file path | none | QSettings `densityModelPath` | none | none | missing file | [VERIFIED] |
| F-176 | Density | Device | Choose device auto/cpu/cuda. | Combo | Density dock | Model group | `device_combo.currentTextChanged` | Read in `_density_load_model()` | Device selection | auto/cpu/cuda | auto | QSettings `densityDevice` | none | none | cuda unavailable | [VERIFIED] |
| F-177 | Density | Load model | Load weights. | Button | Density dock | Model group | `load_btn.clicked` | `_density_load_model()` in `src/phage_annotator/gui_controls_density.py` | `DensityPredictor.load()` | path/device | none | `.phageproj` | loads model | may take time | invalid model | [VERIFIED] |
| F-178 | Density | Input target | Select panel for inference. | Combo | Density dock | Input group | `target_combo.currentTextChanged` | Read in `_density_run()` | Target panel | Frame/Mean/Composite/Support | Frame | QSettings `densityTargetPanel` | uses projection if needed | may compute projection | missing projection | [VERIFIED] |
| F-179 | Density | ROI only | Restrict inference to ROI. | Check | Density dock | Input group | `roi_only_chk` | Read in `_density_infer_options_from_ui()` | bool | True | `.phageproj` | uses ROI mask | improves speed | ROI missing | [VERIFIED] |
| F-180 | Density | Normalize & percentiles | Preprocess configuration. | Combo/Spin | Density dock | Preprocess | `normalize_combo`/`p_low_spin`/`p_high_spin`/`invert_chk` | `_density_config_from_ui()` in `gui_controls_density.py` | `DensityConfig` | percentile/zscore/minmax | 1/99 | `.phageproj` | affects model input | none | invalid ranges | [VERIFIED] |
| F-181 | Density | Tiling options | Tile/overlap/batch. | SpinBoxes | Density dock | Inference | `tile_spin`/`overlap_spin`/`batch_spin` | `_density_infer_options_from_ui()` in `gui_controls_density.py` | `DensityInferOptions` | tile 64–1024 | 256/32/8 | `.phageproj` | affects memory | heavy if large | invalid for ROI | [VERIFIED] |
| F-182 | Density | Run | Run inference. | Button | Density dock | Inference | `run_btn.clicked` | `_density_run()` in `src/phage_annotator/gui_controls_density.py` | `run_density_inference()` via jobs | model config | none | `.phageproj` | heavy job | uses jobs; GPU | cancel/stale results | [VERIFIED] |
| F-183 | Density | Cancel | Cancel inference job. | Button | Density dock | Inference | `cancel_btn.clicked` | `_density_cancel()` in `src/phage_annotator/gui_controls_density.py` | `JobManager.cancel()` | job id | disabled | none | cancels job | improves responsiveness | cancellation delay | [VERIFIED] |
| F-184 | Density | Overlay toggle | Show density overlay. | Check | Density dock | Output | `overlay_chk.toggled` | `_density_overlay_toggle()` in `src/phage_annotator/gui_controls_density.py` | Updates overlay + refresh | bool | False | none | uses overlay map | minor | None | [VERIFIED] |
| F-185 | Density | Overlay alpha | Set overlay opacity. | SpinBox | Density dock | Output | `overlay_alpha.valueChanged` | `_density_overlay_changed()` in `src/phage_annotator/gui_controls_density.py` | Updates overlay alpha | 0–1 | 0.6 | none | none | minor | None | [VERIFIED] |
| F-186 | Density | Overlay LUT | Set overlay colormap. | Combo | Density dock | Output | `overlay_cmap.currentTextChanged` | `_density_overlay_changed()` in `src/phage_annotator/gui_controls_density.py` | Updates overlay LUT | string | magma | none | none | minor | None | [VERIFIED] |
| F-187 | Density | Contours | Toggle density contours. | Check | Density dock | Output | `contours_chk.toggled` | `_density_overlay_changed()` in `src/phage_annotator/gui_controls_density.py` | Updates contours | bool | False | none | none | minor | None | [VERIFIED] |
| F-188 | Density | Export density map | Save density map. | Button | Density dock | Output | `export_map_btn.clicked` | `_density_export_map()` in `src/phage_annotator/gui_controls_density.py` | File write | path | none | file | I/O | minor | no result | [VERIFIED] |
| F-189 | Density | Export counts CSV | Save counts. | Button | Density dock | Output | `export_counts_btn.clicked` | `_density_export_counts()` in `src/phage_annotator/gui_controls_density.py` | CSV write | path | none | file | I/O | minor | no result | [VERIFIED] |
| F-190 | Export | Export View dialog options | Panel, overlays, region, scope. | Dialog controls | Export View dialog | Export dialog | `ExportDialog` in `gui_export.py` | `_export_view_dialog()` in `src/phage_annotator/gui_export.py` | `_export_view_job()` -> `render_view_to_array()` | Panel/overlays/ROI | default current | none | render pipeline | heavy for batch | large stacks | [VERIFIED] |
| F-191 | Preferences | Autosave recovery | Enable autosave. | Checkbox | Preferences dialog | Preferences | `autosave_chk` | `_show_preferences_dialog()` in `gui_controls_preferences.py` | QSettings `autosaveRecoveryEnabled` | bool | True | QSettings `autosaveRecoveryEnabled` | writes recovery files | minimal | disk full | [VERIFIED] |
| F-192 | Preferences | Recent images count | Number of recent items. | SpinBox | Preferences dialog | Preferences | `recent_spin` | `_show_preferences_dialog()` in `gui_controls_preferences.py` | QSettings `keepRecentImages` | 0–50 | 10 | QSettings `keepRecentImages` | none | none | none | [VERIFIED] |
| F-193 | Preferences | Default layout preset | Startup layout. | Combo | Preferences dialog | Preferences | `preset_combo` | `_show_preferences_dialog()` in `gui_controls_preferences.py` | `apply_preset()` | Default/Annotate/Analyze/Minimal | Default | QSettings `defaultLayoutPreset` | none | none | none | [VERIFIED] |
| F-194 | Preferences | Default colormap | Startup LUT. | Combo | Preferences dialog | Preferences | `cmap_combo` | `_show_preferences_dialog()` in `gui_controls_preferences.py` | Sets LUT index | LUT names | first LUT | QSettings `defaultColormap` | none | none | None | [VERIFIED] |
| F-195 | Preferences | Default FPS | Startup playback FPS. | SpinBox | Preferences dialog | Preferences | `fps_spin` | `_show_preferences_dialog()` in `gui_controls_preferences.py` | Updates speed slider | 1–120 | 10 | QSettings `defaultFPS` | none | none | None | [VERIFIED] |
| F-196 | Preferences | Auto-load annotations | Auto-load on image open. | Checkbox | Preferences dialog | Preferences | `autoload_ann_chk` | `_show_preferences_dialog()` in `gui_controls_preferences.py` | QSettings `autoLoadAnnotations` | bool | True | QSettings `autoLoadAnnotations` | triggers annotation parsing | may load many files | large folders | [VERIFIED] |
| F-197 | Preferences | Apply annotation metadata | Apply metadata on import. | Checkbox | Preferences dialog | Preferences | `apply_meta_chk` | `_show_preferences_dialog()` in `gui_controls_preferences.py` | QSettings `applyAnnotationMetaOnLoad` | bool | False | QSettings `applyAnnotationMetaOnLoad` | affects view state | none | metadata missing | [VERIFIED] |
| F-198 | Preferences | Encode metadata in filename | Add tokens to CSV/JSON names. | Checkbox | Preferences dialog | Preferences | `encode_meta_chk` | `_show_preferences_dialog()` in `gui_controls_preferences.py` | QSettings `encodeAnnotationMetaFilename` | bool | False | QSettings `encodeAnnotationMetaFilename` | none | none | none | [VERIFIED] |
| F-199 | Preferences | Pyramid enable/levels | Enable pyramid & levels. | Checkbox/SpinBox | Preferences dialog | Preferences | `pyramid_chk`, `pyramid_levels_spin` | `_show_preferences_dialog()` in `gui_controls_preferences.py` | QSettings `pyramidEnabled`, `pyramidMaxLevels` | bool/1–4 | False/3 | QSettings | affects cache | improves zoom | memory usage | [VERIFIED] |
| F-200 | Preferences | Prefetch block size | Block prefetch size. | SpinBox | Preferences dialog | Preferences | `block_spin` | `_show_preferences_dialog()` in `gui_controls_preferences.py` | QSettings `prefetchBlockSizeFrames` | 4–256 | 64 | QSettings | affects buffer | impacts playback smoothness | too big memory | [VERIFIED] |
| F-201 | Preferences | Prefetch inflight | Max inflight blocks. | SpinBox | Preferences dialog | Preferences | `inflight_spin` | `_show_preferences_dialog()` in `gui_controls_preferences.py` | QSettings `prefetchMaxInflightBlocks` | 1–8 | 2 | QSettings | affects memory | impacts playback smoothness | too many inflight | [VERIFIED] |
| F-202 | Preferences | Throttle analysis Hz | Throttle analysis during playback. | SpinBox | Preferences dialog | Preferences | `throttle_spin` | `_show_preferences_dialog()` in `gui_controls_preferences.py` | QSettings `throttleAnalysisHzDuringPlayback` | 0.5–10 Hz | 2 | QSettings | reduces contention | improves playback | too low -> stale | [VERIFIED] |
| F-203 | Debug | Logs dock | View logs/errors. | Dock | Dock: Logs | Logs panel | `log_view` in `ui_docks.make_logs_widget` | `_append_log()` in `src/phage_annotator/gui_jobs.py` | Append to QPlainTextEdit | n/a | visible | QSettings layout | log buffer | minimal | none | [VERIFIED] |
| F-204 | Debug | Recorder dock | View action recorder. | Dock | Dock: Recorder | Recorder panel | `RecorderWidget` | `RecorderWidget` in `recorder.py` | ActionRecorder records actions | action list | hidden | QSettings layout | none | minimal | none | [VERIFIED] |
| F-205 | Debug | Metadata dock | Show raw metadata tree. | Dock | Dock: Metadata | Metadata panel | `MetadataDock` | `_on_metadata_dock_visibility()` in `src/phage_annotator/gui_actions.py` | `metadata_reader.read_metadata()` | image path | hidden | none | reads tags only | minor | no metadata | [VERIFIED] |
| F-206 | Other | Ortho Views | XZ/YZ cross-sections. | Dock | Dock: Ortho Views | Ortho panel | `OrthoViewWidget` | `OrthoViewWidget` in `src/phage_annotator/orthoview.py` | memmap slicing | n/a | visible | none | uses memmap views | can be heavy | no Z | [VERIFIED] |
| F-207 | Other | Histogram dock | Histogram plot and controls. | Dock visibility | Dock: Histogram | Histogram panel | `hist_canvas` + controls in `ui_docks.make_hist_widget` | `gui_rendering._draw_diagnostics()` updates plot | `_refresh_image()` -> `_draw_diagnostics()` -> `_hist_values()` | Bins/region/scope controls | bins default from `self.hist_bins` | none | Uses cached histogram (sampled stack) | Redraw cost; job for sampled stack | Large arrays; ROI/crop invalid | [VERIFIED] |
| F-208 | Other | Line Profile dock | Plot line profile. | Dock visibility | Dock: Line Profile | Profile panel | `profile_canvas` in `ui_docks.make_profile_widget` | `gui_rendering._draw_diagnostics()` updates plot | `_refresh_image()` -> `_draw_diagnostics()` | Profile line endpoints | none | none | No extra | Minor redraw | No line set | [VERIFIED] |
| F-209 | Other | Sidebar Analyze panel buttons | Quick access to ROI/analysis. | Buttons | Sidebar > Analyze | ROI/Analysis sections | `roi_reset`/`roi_show`/`line_btn`/`bleach_btn`/`table_btn` | Handlers in `src/phage_annotator/gui_ui_extra.py` | `_reset_roi()` / `_show_*_dialog()` | n/a | none | none | none | may open dialogs | none | [VERIFIED] |
| F-210 | Other | Cache stats in status bar | Show cache usage. | Status text | Status bar | Status | `cache_stats_label` | `_update_status()` in `src/phage_annotator/gui_table_status.py` | `ProjectionCache.stats()` | MB/items | n/a | none | no effect | minimal | none | [VERIFIED] |
| F-211 | Other | Playback buffer stats | Buffer filled/inflight/underruns. | Status text | Status bar | Status | `buffer_stats_label` | `_update_buffer_stats()` in `src/phage_annotator/gui_state.py` | `RingBuffer.stats()` | frames/block | n/a | QSettings `prefetch*` | ring buffer | informs perf | underrun count | [VERIFIED] |
| F-212 | Other | Axis warning banner | Auto axis interpretation warning. | Banner click | Settings pane | Axis warning | `axis_warning.linkActivated` | `_focus_axis_mode_control()` in `src/phage_annotator/gui_controls_display.py` | Focus axis combo | n/a | none | none | none | missing metadata | [VERIFIED] |
| F-213 | Other | Recent annotations metadata banner | Apply metadata from imported annotations. | Banner | Main window | Meta banner | `annotation_meta_widget` | `_apply_annotation_metadata()` in `src/phage_annotator/gui_actions.py` | `SessionController.set_roi/set_crop/set_display` | ROI/crop/display | n/a | none | none | minor | metadata missing | [VERIFIED] |
| F-214 | Other | Command palette search | Filter actions list. | Text input | Command palette dialog | Search | `search.textChanged` | `_populate()` in `src/phage_annotator/gui_ui_extra.py` | List filtering | text | empty | none | none | minimal | none | [VERIFIED] |
| F-215 | Other | Command palette activate | Run selected action. | Enter/double click | Command palette dialog | List | `listw.itemActivated` / `search.returnPressed` | `_activate()` in `src/phage_annotator/gui_ui_extra.py` | QAction.trigger() | selection | n/a | none | none | minimal | disabled actions | [VERIFIED] |
| F-216 | Display | Reset view (key `r`) | Reset zoom/contrast from the canvas. | Key press | Canvas | Matplotlib key event | `mpl_connect(\"key_press_event\")` in `gui_events._bind_events` | `_on_key()` in `src/phage_annotator/gui_events.py` | `_on_key()` -> `reset_all_view()` | key `r` | n/a | none | none | minor redraw | None | [VERIFIED] |
| F-217 | Display | Cycle LUT (key `c`) | Cycle through LUTs without opening the menu. | Key press | Canvas | Matplotlib key event | `mpl_connect(\"key_press_event\")` in `gui_events._bind_events` | `_on_key()` in `src/phage_annotator/gui_events.py` | `_on_key()` -> update `lut_combo` -> `_refresh_image()` | key `c` | n/a | none | none | minor redraw | LUT list empty | [VERIFIED] |
| F-218 | Export | Quick save CSV (key `s`) | Save annotations CSV to default path. | Key press | Canvas | Matplotlib key event | `mpl_connect("key_press_event")` -> `_on_key()` | `_on_key()` in `src/phage_annotator/gui_events.py` | `_quick_save_csv()` in `gui_export.py` | key `s` | n/a | QSettings `encodeAnnotationMetaFilename` | writes CSV | minor I/O | write failure | [VERIFIED] |
| F-219 | Playback | Keyboard step/play | Arrow keys step T/Z; Space toggles T playback. | Key press | Main window | Qt keyPressEvent | `keyPressEvent` in `src/phage_annotator/gui_events.py` | `keyPressEvent()` in `src/phage_annotator/gui_events.py` | `_step_slider()` or `_toggle_play(\"t\")` | Left/Right/Up/Down/Space | n/a | none | none | minor | No images loaded | [VERIFIED] |
| F-220 | Annotations | Delete/Backspace / Shift+R | Delete selected annotations or clear ROI in ROI tools. | Key press | Main window | Qt keyPressEvent | `keyPressEvent` in `src/phage_annotator/gui_events.py` | `keyPressEvent()` in `src/phage_annotator/gui_events.py` | `_delete_selected_annotations()` or `_clear_roi()` | Delete/Backspace; Shift+R | n/a | none | none | minor | No selection / no ROI | [VERIFIED] |


## Verification Notes
- Rows updated vs draft:
  - F-001 to F-003: Verified CLI options and call paths in `src/phage_annotator/cli.py` and `src/phage_annotator/gui_mpl.py`.
  - F-004 to F-010: Verified File menu actions, handlers, and annotation load job path in `src/phage_annotator/ui_actions.py`, `src/phage_annotator/gui_ui_setup.py`, `src/phage_annotator/gui_actions.py`.
  - F-011 to F-012: Implemented and verified `SessionController.save_csv/save_json` (now routed to `annotations.save_keypoints_*`).
  - F-018 to F-020: Corrected handler locations for overlay/ROI handles/recorder toggles (`gui_rendering.py`, `gui_roi_crop.py`, `gui_controls_recorder.py`).
  - F-033 to F-034: Verified SMLM overlay toggles route to `_refresh_image()` in `gui_controls_smlm.py`.
  - F-040 to F-041: Verified Clear ROI and Reload annotations call paths (`gui_roi_crop.py`, `gui_actions.py`).
  - F-050 and F-052: Verified About dialog and Reset View handler locations (`gui_actions.py`, `gui_events.py`).
  - F-021 to F-027: Verified layout presets, reset/save layout, and link zoom actions (menu wiring in `ui_actions.py`, handlers in `gui_ui_extra.py`/`gui_actions.py`).
  - F-016 to F-017: Verified Preferences dialog wiring and Exit action.
  - F-036 to F-039: Verified Undo/Redo/Copy Display/Measure Results wiring.
  - F-042 to F-049: Verified Analyze menu actions for dialogs/panels.
  - F-051 and F-053: Verified Command Palette and Dev Demo Job wiring.
  - F-054 to F-066: Verified navigation/playback controls and corrected handler locations.
  - F-091 to F-092: Verified annotation table handlers in `gui_table_status.py`.
  - F-057 to F-090: Verified remaining navigation/display controls and ROI UI wiring.
  - F-093 to F-109: Verified annotation label/scope/target and ROI controls wiring.
  - F-123 to F-130: Verified tool selector actions and zoom/limits handling.
  - F-110 to F-117: Verified ROI Manager actions.
  - F-131 to F-135: Verified Results dock actions.
  - F-136 to F-149: Verified SMLM panel actions (ThunderSTORM/Deep-STORM).
  - F-150 to F-174: Verified Threshold and Analyze Particles panel controls.
  - F-175 to F-189: Verified Density panel controls and handlers.
  - F-190 to F-202: Verified Export View options and Preferences controls.
  - F-203 to F-206: Verified Logs/Recorder/Metadata/Ortho docks.
  - F-209 to F-215: Verified Sidebar Analyze buttons and command palette search/activate.
  - F-218: Verified quick-save CSV shortcut.
  - F-063: Verified speed slider has no direct handler; playback reads `speed_slider.value()` in `gui_playback.py`.
  - F-118 to F-120: Verified histogram controls flow to `_refresh_image()` and `_draw_diagnostics()` in `gui_rendering.py`.
  - F-121 to F-122: Marked missing profile toggle/clear controls (no definitions found in code).
  - F-028 to F-032: Verified Image Panels toggles call `_on_panel_toggle()` and rebuild the figure layout (`ui_actions.py`, `gui_roi_crop.py`).
  - F-035: Verified Dock Panels menu toggles via `wire_dock_action()` in `ui_docks.py`.
  - F-013 to F-015: Verified export view and project save/load call paths (`gui_export.py`, `session_controller_project.py`, `project_io.py`).
  - F-207 to F-208: Verified histogram/profile dock rendering via `_draw_diagnostics()` in `gui_rendering.py`.
  - F-216 to F-220: Added keyboard shortcut rows for canvas and main-window key handling (verified in `gui_events.py`).
  - F-100 to F-107: Auto-ROI persistence includes `.phageproj` keys `auto_roi_*` and QSettings sync; backend uses controller setters (verified in `gui_export.py`, `session_controller_project.py`, `gui_roi_crop.py`).
  - F-104: Auto-ROI bumps job generation (`_job_generation += 1`) to invalidate stale jobs (verified in `gui_roi_crop.py`).
  - F-167: Create ROI from mask routes through `SessionController.set_roi` (verified in `gui_controls_threshold.py`).
- Rows not fully verified:
  - No rows remain tagged [PARTIAL] after verification; only [MISSING] remain where UI widgets are referenced but not defined.

## Improvements (full list)
1) Fix indentation/formatting errors in GUI modules (e.g., `gui_controls_preferences.py`, `gui_controls_results.py`, `gui_controls_display.py`, `gui_controls_roi.py`) to avoid accidental nesting and unreachable code.
2) Add missing imports in results/ROI modules (e.g., `pathlib`, `roi_mask_from_points`, `roi_stats`) and remove unused imports to prevent runtime errors.
3) Implement or remove the missing Line Profile toggle/clear controls (F-121/F-122) so the UI and wiring are consistent.
4) Add a single ROI source-of-truth adapter to eliminate UI `roi_rect/roi_shape` duplication and desync.
5) Add progress + cancel UI for long operations: folder open, annotation bulk load, ROI mean over time, threshold auto on large stacks.
6) Add validation/clamping for ROI/crop inputs against image bounds with immediate feedback.
7) Provide undo/redo for non-annotation operations (ROI, crop, display mapping, threshold apply).
8) Add a consolidated “Performance” panel showing cache/buffer/job status with quick actions.
9) Add a background scan for recent images to remove missing paths automatically.
10) Standardize persistence: migrate transient settings (marker size, click radius, tool selection) to QSettings.
11) Add per-panel display mapping controls (vmin/vmax/gamma/LUT) instead of global only.
12) Add warning dialog when applying destructive display mapping or threshold apply.
13) Move histogram/profile heavy updates to background jobs consistently, with throttling during playback.
14) Add batch export with progress and optional headless run.
15) Add a searchable preferences dialog with descriptions, reset-to-defaults, and validation.
16) Improve error reporting in Logs dock with clickable stack traces and severity filtering.
17) Add unit tests for command palette action inventory + View menu toggle wiring.
18) Add multi-image ROI management (copy ROI between images) and bulk measurement presets.
19) Add missing `build_annotation_metadata()` (referenced in export) or remove the call to avoid runtime error.
20) Add explicit defaults for annotation label list if empty and guard label UI for empty state.
21) Add safeguards when SMLM/density results are stale (image/crop/ROI change), with clear UI messaging.
22) Add I/O error handling for Export View and project save/load (atomic save + backup).
23) Add optional autosave size limit/cleanup to prevent `.recovery` growth.
24) Ensure `recentImages` list updates on failed open (remove missing files automatically).
25) Add GPU availability checks and clear error messages for Deep-STORM and Density model inference.
26) Add per-image UI metadata tooltips for axis interpretation and pixel size source.
27) Add test coverage for annotation import formats and threshold/particle pipelines (pure-logic tests).
28) Add deterministic random seeding for any sampling-based computations (auto contrast, threshold sampling).
29) Add cache eviction telemetry and warnings when cache hits 90% of budget.
30) Add optional export of overlays as separate layers for WYSIWYG exports.
31) Ensure Project load handles missing image paths with a warning dialog and partial load.
32) Add guardrails for exporting when support image is missing or projections are unavailable.
33) Add status messages for annotation auto-load progress and completion.
34) Add “Clear histogram cache” action to reset sampled stack histograms.
35) Add preferences for histogram bins default and profile sampling resolution.
36) Add consistent objectName for QActions/widgets to improve testability and command palette indexing.
37) Add keyboard shortcut reference/help menu for all tools and playback controls.
38) Add lints/formatting (PEP8) and enforce max line length for CI readiness.
